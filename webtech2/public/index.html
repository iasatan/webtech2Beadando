<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <script type="text/javascript" src="js/angular.min.js"></script>
</head>
<body ng-app="index" ng-controller="indexCtrl">
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Könyvtár</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#" ng-click="list()">List Books</a></li>
                <li><a href="#" ng-click="list3()">List Books By</a></li>
                <li><a href="#" ng-click="list2()">List Lends</a></li>
                <li><a href="#" ng-click="edit()">Edit User</a></li>
                <li><a href="#" ng-click="logout()">Log Out</a></li>
            </ul>
        </div>
    </nav>
    <div>
        <h1 id="user">Welcome </h1>
    </div>
    <div id="edit" ng-show="editDiv" ng-include="'edit'">

    </div>
    <div id="lends" class="container" ng-show="lendsDiv">
        <div ng-repeat="x in lends">
            Lends<br />
            <table border="1" class="table table-hover">
                <tbody>
                    <tr>
                        <td>User Name:</td>
                        <td>{{ x.name }}</td>
                    </tr>
                    <tr>
                        <td>Book name:</td>
                        <td>{{ x.book }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="bookList" ng-show="bookListDiv">
        <div class="container">
            <div ng-repeat="x in books">
                <table border="1" class="table table-hover">
                    <tbody>
                        <tr>
                            <td>Name:</td>
                            <td>{{ x.name }}</td>
                        </tr>
                        <tr>
                            <td>Genre:</td>
                            <td>{{ x.genre }}</td>
                        </tr>
                        <tr>
                            <td>Author:</td>
                            <td>{{ x.author }}</td>
                        </tr>
                        <tr>
                            <td>Available:</td>
                            <td>
                                {{x.status}} <form action="http://127.0.0.1:8081/requestBook" method="GET">
                                    <input hidden="hidden" name="name" value="{{ x.name }}" />
                                    <input type="submit" class="btn" value="Request">
                                </form>
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="bookListBy" ng-show="bookListByDiv">
        <div class="container">
            <h2>List by Genre</h2>
            <form action="http://127.0.0.1:8081/listByGenre" method="GET">
                <div class="form-group">
                    <select name="genre"><option ng-repeat="x in genres">{{x}}</option></select>
                </div>
                <input type="submit" class="btn" value="Submit">
            </form>
        </div>
        <div class="container">
            <h2>List by Author</h2>
            <form action="http://127.0.0.1:8081/listByAuthor" method="GET">
                <div class="form-group">
                    <select name="author"><option ng-repeat="x in authors">{{x}}</option></select>
                </div>
                <input type="submit" class="btn" value="Submit">
            </form>
        </div>
        <div class="container">
            <h2>List By status</h2>
            <form action="http://127.0.0.1:8081/listByStatus" method="GET">
                <div class="form-group">
                    <select name="status"><option ng-repeat="x in status">{{x}}</option></select>
                </div>
                <input type="submit" class="btn" value="Submit">
            </form>
        </div>
        <div id="bookList" class="container">
            <div ng-repeat="x in books">
                <table border="1" class="table table-hover">
                    <tbody>
                        <tr>
                            <td>Name:</td>
                            <td>{{ x.name }}</td>
                        </tr>
                        <tr>
                            <td>Genre:</td>
                            <td>{{ x.genre }}</td>
                        </tr>
                        <tr>
                            <td>Author:</td>
                            <td>{{ x.author }}</td>
                        </tr>
                        <tr>
                            <td>Available:</td>
                            <td>
                                {{x.status}} <form action="http://127.0.0.1:8081/requestBook2" method="GET">
                                    <input hidden="hidden" name="name" value="{{ x.name }}" />
                                    <input type="submit" class="btn" value="Request">
                                </form>
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        var contentList = [document.getElementById('edit'), document.getElementById('lends'), document.getElementById('bookList'), document.getElementById('bookListBy')];
        var index = angular.module("index", []);
        index.controller("indexCtrl", function ($scope, $http, $compile) {
            angular.element(document).ready(function () {
                $http.get('genres').then(function (response) { $scope.genres = response.data });
                $http.get('authors').then(function (response) { $scope.authors = response.data });
                $http.get('status').then(function (response) { $scope.status = response.data });
                $http.get('listBy').then(function (response) { $scope.books = response.data.books });
                $http.get('user').then(function (response) { document.getElementById('user').innerHTML += response.data.userName; });
                $http.get('page').then(function (response) {
                    switch (response.data) {
                        case "bookListBy":
                            $scope.bookListByDiv = true;
                            break;
                        case "bookList":
                            $scope.bookListDiv = true;
                            break;
                        case "edit":
                            $scope.editDiv = true;
                            break;
                    }
                })
            });
            $scope.list3 = function () {
                $scope.editDiv = false;
                $scope.lendsDiv = false;
                $scope.bookListDiv = false;
                $scope.bookListByDiv = true;
            }

            $scope.list = function () {
                $scope.editDiv = false;
                $scope.lendsDiv = false;
                $scope.bookListDiv = true;
                $scope.bookListByDiv = false;
                $http.get('books').then(function (response) {
                    $scope.books = response.data.books
                });
            }
            $scope.list2 = function () {
                $scope.editDiv = false;
                $scope.lendsDiv = true;
                $scope.bookListDiv = false;
                $scope.bookListByDiv = false;
                $http.get('myLends').then(function (response) {
                    $scope.lends = response.data.a;
                })
            }
            $scope.edit = function () {
                $scope.editDiv = true;
                $scope.lendsDiv = false;
                $scope.bookListDiv = false;
                $scope.bookListByDiv = false;

                $http.get('user').then(function (response) {
                    document.getElementById('userName').value += response.data.userName;
                    document.getElementById('age').value = response.data.age;
                    document.getElementById('name').value = response.data.name;
                });
            }
            $scope.logout = function () {
                open('logout', "_self");
            }

        });
    </script>
</body>
</html>