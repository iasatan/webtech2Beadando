<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script type="text/javascript" src="js/angular.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
</head>
<body ng-app="index" ng-controller="indexCtrl">
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Könyvtár</a>
            </div>
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a></li>
                <li><a href="#" ng-click="manageBooks()">Manage Books</a></li>
                <li><a href="#" ng-click="inventory()">Manage Inventory</a></li>
                <li><a href="#" ng-click="list()">List Requests</a></li>
                <li><a href="#" ng-click="edit()">Edit User</a></li>
                <li><a href="#" ng-click="logout()">Log Out</a></li>
            </ul>
        </div>
    </nav>
    <div id="user">
        Welcome
    </div>
    <div id="manageBooks" class="container" ng-show="manageBooksDiv">
        <form name="addBookForm" action="http://127.0.0.1:8081/addBook" method="GET">
            <table border="1" class="table">
                <tbody>
                    <tr>
                        <td>Name of the Book:</td>
                        <td><input type="text" name="book" ng-model="book" required><span ng-show="addBookForm.book.$touched && addBookForm.book.$invalid">The name is required.</span></td>
                    </tr>
                    <tr>
                        <td>Author of the Book:</td>
                        <td><select name="author"><option ng-repeat="x in authors">{{x}}</option></select></td>
                    </tr>
                    <tr>
                        <td>Genre of the Book:</td>
                        <td><input type="text" name="genre" ng-model="genre" required> <span ng-show="addBookForm.book.$valid && addBookForm.genre.$valid"><input type="submit" value="Submit"></span><span ng-show="addBookForm.genre.$touched && addBookForm.genre.$invalid">The genre is required.</span></td>
                    </tr>
                </tbody>
            </table>
        </form>
        <br>
        <div class="container">
            <form name="addAuthorForm" action="http://127.0.0.1:8081/addAuthor" method="GET" class="form-inline">
                <div class="form-group">
                    <label>Name of the Author:</label>
                    <input type="text" class="form-control" name="author" placeholder="Enter name" ng-model="author" required>
                </div>
                <span ng-show="addAuthorForm.author.$valid"><input type="submit" value="Submit"></span>
            </form>
        </div>
    </div>
    <div id="edit" ng-show="editDiv" ng-include="'edit'">

    </div>
    <div id="manageInventory" class="container" ng-show="manageInventoryDiv">
        <div ng-repeat="x in inventorryBooks">
            <table border="1" class="table table-hover">
                <tbody>
                    <tr>
                        <td>Name:</td>
                        <td>{{ x.name }}</td>
                    </tr>
                    <tr>
                        <td>Genre:</td>
                        <td>{{ x.genre }}</td>
                    </tr>
                    <tr>
                        <td>Author:</td>
                        <td>{{ x.author }}</td>
                    </tr>
                    <tr>
                        <td>Status:</td>
                        <td>
                            <form name="inventoryForm" action="http://127.0.0.1:8081/addBookInstance" method="GET">
                                <input hidden="hidden" name="name" value="{{ x.name }}" />
                                <input type="number" name="status" value="{{ x.status }}" required min="0">  <br>
                                <input type="submit" value="Submit">
                            </form>
                        </td>
                    </tr>
                </tbody>

            </table>
        </div>
    </div>

    <div id="requests" ng-show="requestsDiv">
        <div ng-repeat="x in request" class="container">
            Requests:<br />
            <table border="1" class="table">
                <tr>
                    <td>User Name:</td>
                    <td>{{ x.user }}</td>
                </tr>
                <tr>
                    <td>Book name:</td>
                    <td>{{ x.book }}</td>
                </tr>
                <tr>
                    <td>Lend:</td>
                    <td>
                        <form action="http://127.0.0.1:8081/lend" method="GET">
                            <input hidden="hidden" name="name" value="{{ x.user }}" />
                            <input hidden="hidden" name="book" value="{{x.book}}" />
                            <input type="submit" value="Submit">
                        </form>
                    </td>
                </tr>
            </table>
        </div>
        <div ng-repeat="x in lends" class="container">
            Lends<br />
            <table border="1" class="table">
                <tbody>
                    <tr>
                        <td>User Name:</td>
                        <td>{{ x.name }}</td>
                    </tr>
                    <tr>
                        <td>Book name:</td>
                        <td>{{ x.book }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <br />
    <script>
        var contentList = [document.getElementById('edit'), document.getElementById('manageBooks'), document.getElementById('manageInventory'), document.getElementById('requests')];
        var index = angular.module("index", []);
        index.controller("indexCtrl", function ($scope, $http) {
            angular.element(document).ready(function () {
                $http.get('user').then(function (response) { document.getElementById('user').innerHTML += response.data.userName; });
                $http.get('authors').then(function (response) { $scope.authors = response.data });
                $http.get('books').then(function (response) { $scope.inventorryBooks = response.data.books });
                $http.get('requests').then(function (response) {
                    $scope.request = response.data.request;
                });
                $http.get('lends').then(function (response) {
                    $scope.lends = response.data.lends;
                })
                $http.get('page').then(function (response) {
                    switch (response.data) {
                        case "manageBooks":
                            $scope.manageBooksDiv = true;
                            break;
                        case "manageInventory":
                            $scope.manageInventoryDiv = true;
                            break;
                        case "requests":
                            $scope.requestsDiv = true;
                            break;
                        case "edit":
                            $scope.editDiv = true;
                            break;
                    }
                })
            });
            $scope.list = function () {
                $scope.requestsDiv = true;;
                $scope.manageBooksDiv = false;
                $scope.manageInventoryDiv = false;
                $scope.editDiv = false;
            }
            $scope.inventory = function () {
                $scope.requestsDiv = false;;
                $scope.manageBooksDiv = false;
                $scope.manageInventoryDiv = true;
                $scope.editDiv = false;
            }

            $scope.manageBooks = function () {
                $scope.requestsDiv = false;;
                $scope.manageBooksDiv = true;
                $scope.manageInventoryDiv = false;
                $scope.editDiv = false;
            }


            $scope.edit = function () {
                $scope.requestsDiv = false;;
                $scope.manageBooksDiv = false;
                $scope.manageInventoryDiv = false;
                $scope.editDiv = true;
                $http.get('user').then(function (response) {
                    document.getElementById('userName').value += response.data.userName;
                    document.getElementById('age').value = response.data.age;
                    document.getElementById('name').value = response.data.name;
                });
            }
            $scope.logout = function () {
                open('logout', "_self");
            }

        });
    </script>
</body>
</html>